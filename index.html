<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª–µ–Ω–¥–∞—Ä—å</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .calendar-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 30px;
            max-width: 500px;
            width: 100%;
            position: relative;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .month-year {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }

        .nav-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .nav-button:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .nav-button:active {
            transform: scale(0.95);
        }

        .tools-panel {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 15px;
        }

        .tool-button {
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .tool-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            transform: scale(1.1);
        }

        .tool-button:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 10px;
        }

        .weekday {
            text-align: center;
            font-weight: bold;
            color: #667eea;
            padding: 10px;
            font-size: 14px;
        }

        .calendar-wrapper {
            position: relative;
        }

        .days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            position: relative;
        }

        .day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 16px;
            color: #333;
            position: relative;
            z-index: 2;
        }

        .day.other-month {
            color: #ccc;
        }

        .day.today {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: bold;
        }

        .day:hover:not(.other-month):not(.today) {
            background: #f0f0f0;
            transform: scale(1.1);
        }

        .day.selected {
            background: #667eea;
            color: white;
        }

        #drawingCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: auto;
            z-index: 3;
            border-radius: 10px;
            background: transparent;
        }
    </style>
</head>
<body>
    <div class="calendar-container">
        <div class="calendar-header">
            <button class="nav-button" id="prevMonth">‚Äπ</button>
            <div class="month-year" id="monthYear"></div>
            <button class="nav-button" id="nextMonth">‚Ä∫</button>
        </div>
        
        <div class="tools-panel">
            <button class="tool-button active" id="pencilBtn" title="–ö–∞—Ä–∞–Ω–¥–∞—à">‚úèÔ∏è</button>
            <button class="tool-button" id="eraserBtn" title="–õ–∞—Å—Ç–∏–∫">üßπ</button>
        </div>

        <div class="weekdays">
            <div class="weekday">–ü–Ω</div>
            <div class="weekday">–í—Ç</div>
            <div class="weekday">–°—Ä</div>
            <div class="weekday">–ß—Ç</div>
            <div class="weekday">–ü—Ç</div>
            <div class="weekday">–°–±</div>
            <div class="weekday">–í—Å</div>
        </div>
        
        <div class="calendar-wrapper">
            <div class="days" id="daysContainer"></div>
            <canvas id="drawingCanvas"></canvas>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        let tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        let currentDate = new Date();
        let selectedDate = null;
        let isDrawing = false;
        let currentTool = 'pencil'; // 'pencil' –∏–ª–∏ 'eraser'
        let canvas, ctx;
        let canvasContainer;

        const monthNames = [
            '–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å',
            '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'
        ];

        // –ü–æ–ª—É—á–∏—Ç—å –∫–ª—é—á –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–∏—Å—É–Ω–∫–∞
        function getStorageKey() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            return `calendar_drawing_${year}_${month}`;
        }

        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–∏—Å—É–Ω–æ–∫
        function saveDrawing() {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é (PNG —Ñ–æ—Ä–º–∞—Ç)
            const dataURL = canvas.toDataURL('image/png');
            const key = getStorageKey();
            localStorage.setItem(key, dataURL);
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ä–∏—Å—É–Ω–æ–∫
        function loadDrawing() {
            const key = getStorageKey();
            const savedData = localStorage.getItem(key);
            
            if (savedData) {
                const img = new Image();
                img.onload = () => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0);
                };
                img.src = savedData;
            } else {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ canvas
        function setupCanvas() {
            canvas = document.getElementById('drawingCanvas');
            ctx = canvas.getContext('2d');
            canvasContainer = document.querySelector('.calendar-wrapper');
            
            const resizeCanvas = () => {
                const daysContainer = document.getElementById('daysContainer');
                const rect = daysContainer.getBoundingClientRect();
                canvas.width = rect.width;
                canvas.height = rect.height;
                canvas.style.width = rect.width + 'px';
                canvas.style.height = rect.height + 'px';
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–∏–ª–µ–π —Ä–∏—Å–æ–≤–∞–Ω–∏—è
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
                
                // –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ canvas –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π —Ä–∏—Å—É–Ω–æ–∫
                loadDrawing();
            };
            
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
        }

        // –ü–æ–ª—É—á–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ canvas
        function getCanvasCoordinates(e) {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            
            let clientX, clientY;
            
            if (e.touches) {
                // –î–ª—è touch —Å–æ–±—ã—Ç–∏–π
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            } else {
                // –î–ª—è mouse —Å–æ–±—ã—Ç–∏–π
                clientX = e.clientX;
                clientY = e.clientY;
            }
            
            return {
                x: (clientX - rect.left) * scaleX,
                y: (clientY - rect.top) * scaleY
            };
        }

        // –ù–∞—á–∞—Ç—å —Ä–∏—Å–æ–≤–∞–Ω–∏–µ
        function startDrawing(e) {
            e.preventDefault();
            isDrawing = true;
            const coords = getCanvasCoordinates(e);
            
            ctx.beginPath();
            ctx.moveTo(coords.x, coords.y);
            
            if (currentTool === 'pencil') {
                ctx.globalCompositeOperation = 'source-over';
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 2;
            } else {
                // –õ–∞—Å—Ç–∏–∫ - –∏—Å–ø–æ–ª—å–∑—É–µ–º destination-out –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –Ω–∞—Ä–∏—Å–æ–≤–∞–Ω–Ω–æ–≥–æ –Ω–∞ canvas
                // –≠—Ç–æ —É–¥–∞–ª–∏—Ç —Ç–æ–ª—å–∫–æ –ø–∏–∫—Å–µ–ª–∏, –Ω–∞—Ä–∏—Å–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞ canvas, –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—è —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ–¥ –Ω–∏–º
                ctx.globalCompositeOperation = 'destination-out';
                ctx.lineWidth = 20;
            }
        }

        // –†–∏—Å–æ–≤–∞–Ω–∏–µ
        function draw(e) {
            if (!isDrawing) return;
            e.preventDefault();
            
            const coords = getCanvasCoordinates(e);
            ctx.lineTo(coords.x, coords.y);
            ctx.stroke();
        }

        // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–∏—Å–æ–≤–∞–Ω–∏–µ
        function stopDrawing(e) {
            if (isDrawing) {
                isDrawing = false;
                saveDrawing();
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
        function setTool(tool) {
            currentTool = tool;
            
            if (tool === 'pencil') {
                document.getElementById('pencilBtn').classList.add('active');
                document.getElementById('eraserBtn').classList.remove('active');
                canvas.style.cursor = 'crosshair';
            } else {
                document.getElementById('eraserBtn').classList.add('active');
                document.getElementById('pencilBtn').classList.remove('active');
                canvas.style.cursor = 'grab';
            }
        }

        function updateCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            document.getElementById('monthYear').textContent = 
                `${monthNames[month]} ${year}`;

            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = (firstDay.getDay() + 6) % 7;

            const daysContainer = document.getElementById('daysContainer');
            daysContainer.innerHTML = '';

            const today = new Date();
            const isCurrentMonth = today.getMonth() === month && today.getFullYear() === year;

            // –î–Ω–∏ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
            const prevMonthLastDay = new Date(year, month, 0).getDate();
            for (let i = startingDayOfWeek - 1; i >= 0; i--) {
                const day = document.createElement('div');
                day.className = 'day other-month';
                day.textContent = prevMonthLastDay - i;
                daysContainer.appendChild(day);
            }

            // –î–Ω–∏ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
            for (let i = 1; i <= daysInMonth; i++) {
                const day = document.createElement('div');
                day.className = 'day';
                
                if (isCurrentMonth && i === today.getDate()) {
                    day.classList.add('today');
                }
                
                if (selectedDate && 
                    selectedDate.getDate() === i && 
                    selectedDate.getMonth() === month && 
                    selectedDate.getFullYear() === year) {
                    day.classList.add('selected');
                }
                
                day.textContent = i;
                day.addEventListener('click', (e) => {
                    // –ù–µ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–∏ —Ä–∏—Å–æ–≤–∞–Ω–∏–∏
                    if (!isDrawing) {
                        selectedDate = new Date(year, month, i);
                        updateCalendar();
                    }
                });
                daysContainer.appendChild(day);
            }

            // –î–Ω–∏ —Å–ª–µ–¥—É—é—â–µ–≥–æ –º–µ—Å—è—Ü–∞
            const totalCells = daysContainer.children.length;
            const remainingCells = 42 - totalCells;
            for (let i = 1; i <= remainingCells; i++) {
                const day = document.createElement('div');
                day.className = 'day other-month';
                day.textContent = i;
                daysContainer.appendChild(day);
            }
            
            // –û–±–Ω–æ–≤–∏—Ç—å canvas –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è
            setTimeout(() => {
                setupCanvas();
            }, 10);
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è canvas
        function setupCanvasEvents() {
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseleave', stopDrawing);
            
            // Touch —Å–æ–±—ã—Ç–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
            canvas.addEventListener('touchstart', startDrawing);
            canvas.addEventListener('touchmove', draw);
            canvas.addEventListener('touchend', stopDrawing);
        }

        // –ö–Ω–æ–ø–∫–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
        document.getElementById('pencilBtn').addEventListener('click', () => setTool('pencil'));
        document.getElementById('eraserBtn').addEventListener('click', () => setTool('eraser'));

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –º–µ—Å—è—Ü–∞–º
        document.getElementById('prevMonth').addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            updateCalendar();
        });

        document.getElementById('nextMonth').addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            updateCalendar();
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        updateCalendar();
        setTimeout(() => {
            setupCanvas();
            setupCanvasEvents();
        }, 100);
    </script>
</body>
</html>
